# 🎉 校园交易系统 - 完整功能说明

## 📊 数据规模

### 样例数据统计
```
✅ 已生成大规模测试数据:
- 👥 用户: 200 人
- 📦 商品: 500 件
- 💬 评论: 1000+ 条
- 📨 消息: 2000+ 条
- 💰 交易: 500 笔
- ⭐ 收藏: 500 个
- 📊 总数据记录: 4000+ 条
```

### SQL 文件大小
```
MySQL:       4835 行
PostgreSQL:  4835 行
MariaDB:     4835 行
SQLite:      4835 行
```

---

## 🎯 双模式系统

### 👤 普通用户模式
**适用对象:** 校内学生  
**主要功能:** 校园二手交易

#### 页面列表
1. **🏪 商品市场** (`/marketplace`)
   - 淘宝风格界面设计
   - 8大商品分类导航
   - 高级筛选 (成色/价格/排序)
   - 网格/列表双视图切换
   - 分页浏览 (20/40/60/100)
   - 商品详情模态框
   - 多图轮播展示
   - 评论留言系统
   - 交易流程管理

2. **💬 消息中心** (`/messages`)
   - 实时聊天界面
   - 会话列表
   - 消息气泡
   - Emoji 支持

3. **📦 我的商品** (`/my-items`)
   - 在售中/已售出/已下架
   - 编辑/删除操作
   - 商品统计

4. **📝 我的订单** (`/orders`)
   - 我买到的/我卖出的
   - 交易时间轴
   - 订单状态追踪

5. **👤 个人中心** (`/profile`)
   - 个人资料
   - 信用分管理
   - 交易记录

---

### 🔧 管理员模式
**适用对象:** 系统管理员  
**主要功能:** 数据库监控、性能优化、高级管理

#### 页面列表

##### 1. 📊 数据仪表盘 (`/admin/dashboard`)
- 整体数据概览
- 趋势图表
- 关键指标

##### 2. 📈 数据分析 (`/admin/analytics`)
- 用户行为分析
- 商品热度分析
- 交易趋势分析

##### 3. 🔄 四库同步控制台 (`/admin/console`)
- MySQL 状态监控
- PostgreSQL 状态监控
- MariaDB 状态监控
- SQLite 状态监控
- 同步日志查看
- 冲突记录管理

##### 4. ⚡ **性能监控中心** (`/admin/performance`) - 🆕
**核心功能展示:**

###### 实时性能指标
```
┌─────────────────────────────────────┐
│ 🔥 系统实时状态                    │
│ - 总用户数: 200 人                  │
│ - 在线用户: 45 人                   │
├─────────────────────────────────────┤
│ 📦 商品统计                         │
│ - 在售商品: 437 件                  │
│ - 今日新增: 23 件                   │
├─────────────────────────────────────┤
│ 💰 交易数据                         │
│ - 总交易额: ¥156,780.5              │
│ - 今日成交: 18 笔                   │
├─────────────────────────────────────┤
│ ⚡ 数据库性能                       │
│ - 平均查询时间: 12.5ms              │
│ - QPS: 342 次/秒                    │
└─────────────────────────────────────┘
```

###### 四数据库同步状态表
| 数据库 | 状态 | 延迟 | 记录数 | 同步版本 | 最后同步 |
|--------|------|------|--------|----------|----------|
| MySQL | ✅在线 | 8ms | 3,247 | v1523 | 2秒前 |
| PostgreSQL | ✅在线 | 12ms | 3,245 | v1522 | 5秒前 |
| MariaDB | ✅在线 | 10ms | 3,247 | v1523 | 3秒前 |
| SQLite | ✅在线 | 3ms | 3,246 | v1523 | 1秒前 |

###### 慢查询分析 (Top 10)
```sql
-- 示例慢查询
Q1001: SELECT * FROM items WHERE status = "available" 
       ORDER BY created_at DESC LIMIT 1000
       执行次数: 1523  平均耗时: 145ms  最大耗时: 320ms
       💡 建议: 添加 (status, created_at) 复合索引

Q1002: SELECT u.*, COUNT(i.id) FROM users u 
       LEFT JOIN items i ON u.id = i.seller_id GROUP BY u.id
       执行次数: 892   平均耗时: 89ms   最大耗时: 178ms
       💡 建议: 使用物化视图缓存聚合结果
```

###### 连接池监控
```
MySQL 连接池:        [████████░░] 40% (8/20 活跃)
PostgreSQL 连接池:   [██████░░░░] 30% (6/20 活跃)
MariaDB 连接池:      [███████░░░] 35% (7/20 活跃)
SQLite 连接:         [██████████] 100% (1/1 活跃)
```

###### 系统健康度仪表盘
```
        ┌─────────────┐
        │     92      │  优秀
        │             │
        └─────────────┘

指标明细:
- 数据库连接状态: 98%  ✅
- 查询响应速度:   92%  ✅
- 同步一致性:     96%  ✅
- 系统资源使用:   65%  ✅
```

###### 实时查询监控
```
当前正在执行 2 个查询:
- [MySQL] SELECT * FROM items WHERE category_id = 2 (156ms)
- [PostgreSQL] INSERT INTO audit_logs ... (23ms)
```

##### 5. ⚙️ **高级操作中心** (`/admin/operations`) - 🆕
**核心功能展示:**

###### 批量数据操作
```
用户批量管理:
┌──────────────────────────────────────┐
│ 选择条件: [30天未登录 ▼]             │
│ 操作:     [删除账号 ▼]               │
│ 预计影响: 15 人                      │
│ [执行批量操作]                       │
└──────────────────────────────────────┘

商品批量管理:
┌──────────────────────────────────────┐
│ 商品状态: [在售 ▼]  天数: [90]      │
│ 操作:     [归档 ▼]                   │
│ 预计影响: 42 件                      │
│ [执行批量操作]                       │
└──────────────────────────────────────┘

交易批量处理:
┌──────────────────────────────────────┐
│ ☑ 待处理  ☑ 已取消  ☑ 超时未完成    │
│ [清理选中类型的交易记录]            │
└──────────────────────────────────────┘
```

###### 数据导入/导出
```
导出功能:
┌──────────────────────────────────────┐
│ 选择表:                              │
│ ☑ 用户数据  ☑ 商品数据               │
│ ☑ 交易数据  ☑ 评论数据               │
│ ☑ 消息数据  ☑ 审计日志               │
│                                      │
│ 格式: [JSON ▼]                       │
│ [🔽 导出数据] [📅 定时导出]          │
└──────────────────────────────────────┘

导入功能:
┌──────────────────────────────────────┐
│ [选择文件] data.sql (1.2 MB)         │
│ 模式: ⚫ 替换  ⚪ 追加  ⚪ 更新        │
│ [🔼 开始导入]                        │
└──────────────────────────────────────┘
```

###### 同步冲突解决
```
检测到 2 个数据同步冲突:

冲突详情:
┌─────────────────────────────────────────────────────┐
│ ID: CONF001                                         │
│ 表: items  记录ID: 1234                             │
│ 冲突类型: 版本冲突                                  │
│                                                     │
│ 源数据 (MySQL):                                     │
│ { title: "iPhone 12", price: 1200, version: 5 }    │
│                                                     │
│ 目标数据 (PostgreSQL):                              │
│ { title: "iPhone 12", price: 1150, version: 4 }    │
│                                                     │
│ [查看详情] [使用源] [使用目标] [手动解决]           │
└─────────────────────────────────────────────────────┘
```

###### 高级 SQL 执行器
```
┌─────────────────────────────────────────────────────┐
│ 目标数据库: [MySQL ▼]                               │
├─────────────────────────────────────────────────────┤
│ SELECT * FROM items                                 │
│ WHERE status = 'available'                          │
│ AND price < 100                                     │
│ ORDER BY created_at DESC                            │
│ LIMIT 20;                                           │
├─────────────────────────────────────────────────────┤
│ [▶️ 执行SQL] [📊 EXPLAIN] [🎨 格式化] [🗑️ 清空]   │
├─────────────────────────────────────────────────────┤
│ 执行结果:                                           │
│ {                                                   │
│   "success": true,                                  │
│   "rowsAffected": 5,                                │
│   "executionTime": "23ms"                           │
│ }                                                   │
└─────────────────────────────────────────────────────┘
```

###### 系统维护工具
```
🧹 数据清理          📊 索引管理          🔐 安全审计
- 清理过期会话       - 分析索引使用率     - 查看审计日志
- 清理已删除记录     - 重建索引           - 导出审计日志
- 清理临时文件       - 智能索引建议       - 检测异常行为
- VACUUM 优化        - 优化表结构         - 锁定可疑用户

📈 性能优化          💾 备份恢复          🔄 同步管理
- 慢查询分析         - 创建备份           - 强制全量同步
- 预热缓存           - 查看备份列表       - 暂停同步
- 调整连接池         - 恢复备份           - 恢复同步
- 自动优化           - 定时备份设置       - 配置同步规则
```

##### 6. 👥 用户管理 (`/admin/users`)
- 用户列表
- 信用分管理
- 封禁/解封
- 实名认证审核

##### 7. ⚙️ 系统设置 (`/admin/settings`)
- 平台配置
- 参数调整
- 权限管理

---

## 🗄️ 数据库架构

### 四数据库同步机制
```
┌─────────┐    ┌──────────────┐    ┌─────────┐
│  MySQL  │◄──►│ Sync Engine  │◄──►│ MariaDB │
└─────────┘    └──────────────┘    └─────────┘
                      ▲
                      │
                ┌─────┴──────┐
                │            │
           ┌─────▼───┐  ┌────▼─────┐
           │ Postgres│  │  SQLite  │
           └─────────┘  └──────────┘
```

### 核心表结构 (12张表)

#### 业务表
1. **users** - 用户表
   - 信用评分系统
   - 卖家/买家评分
   - 实名认证状态

2. **categories** - 商品分类
   - 8大分类体系

3. **items** - 商品表
   - 成色标注
   - 标签系统 (JSON)
   - 多状态管理

4. **item_images** - 商品图片
   - 支持5张图片
   - 封面图标记

5. **comments** - 评论表
   - 楼中楼回复
   - 父评论关联

6. **transactions** - 交易表
   - 5种交易状态
   - 价格议价记录
   - 评分系统

7. **messages** - 消息表
   - 已读/未读标记
   - 双向删除

8. **favorites** - 收藏表
   - 用户收藏统计

9. **reports** - 举报表
   - 5种举报类型
   - 管理员审核

#### 系统表
10. **audit_logs** - 审计日志
    - 所有操作追踪
    - IP地址记录

11. **conflict_records** - 同步冲突记录
    - 冲突检测
    - 解决策略

12. **system_configs** - 系统配置
    - 平台参数
    - 功能开关

---

## 🎨 技术特性

### 数据库特性对比

| 特性 | MySQL | PostgreSQL | MariaDB | SQLite |
|------|-------|------------|---------|--------|
| 全文搜索 | FULLTEXT | FTS | FULLTEXT | FTS5 |
| JSON支持 | JSON | JSONB | JSON | TEXT |
| 分区表 | ✅ | ✅ | ✅ | ❌ |
| 触发器 | ✅ | ✅ | ✅ | ✅ |
| 存储过程 | ✅ | 函数 | ✅ | ❌ |
| 版本化表 | ❌ | ❌ | ✅ System-versioned | ❌ |

### 性能优化

#### 索引策略
```sql
-- 复合索引
CREATE INDEX idx_items_status_created ON items(status, created_at);

-- 全文索引
CREATE FULLTEXT INDEX idx_items_search ON items(title, description);

-- JSONB GIN 索引 (PostgreSQL)
CREATE INDEX idx_items_tags ON items USING GIN(tags);
```

#### 触发器应用
```sql
-- 自动更新统计
CREATE TRIGGER trg_after_transaction_complete
AFTER UPDATE ON transactions
FOR EACH ROW
BEGIN
    UPDATE users SET total_sales = total_sales + 1 
    WHERE id = NEW.seller_id;
END;
```

#### 存储过程
```sql
-- 创建交易（带事务）
CALL sp_create_transaction(1234, 567, '138xxxx', @trans_id, @error);
```

---

## 📱 前端技术栈

```
Vue 3.4 + TypeScript
├── Naive UI (组件库)
├── Vue Router 4 (路由)
├── Pinia (状态管理)
├── Tailwind CSS (样式)
└── UnoCSS (原子化CSS)
```

### 组件使用统计
```
NCard, NButton, NSpace, NTable, NTag, NModal, 
NProgress, NStatistic, NAlert, NSpin, NTabs, 
NForm, NSelect, NInput, NCheckbox, NUpload, ...
(共使用 50+ Naive UI 组件)
```

---

## 🚀 部署与使用

### 启动前端
```bash
cd frontend
npm install
npm run dev
```

访问: http://localhost:5174

### 初始化数据库

#### MySQL
```bash
mysql -u root -p campus_trading < backend/sql/mysql_complete_schema.sql
mysql -u root -p campus_trading < backend/sql/mysql_complete_inserts.sql
```

#### PostgreSQL
```bash
psql -U postgres -d campus_trading -f backend/sql/postgres_complete_schema.sql
psql -U postgres -d campus_trading -f backend/sql/postgres_complete_inserts.sql
```

#### SQLite
```bash
sqlite3 campus_trading.db < backend/sql/sqlite_complete_schema.sql
sqlite3 campus_trading.db < backend/sql/sqlite_complete_inserts.sql
```

---

## 🎯 测试场景

### 用户端测试
1. 浏览商品市场（500件商品）
2. 使用筛选和排序功能
3. 查看商品详情和评论（1000+评论）
4. 发表评论和回复
5. 点击"我想要"查看交易流程
6. 查看消息中心（2000+消息）

### 管理员测试
1. 查看性能监控仪表盘
   - 实时数据刷新
   - 自动刷新功能
2. 监控四数据库同步状态
3. 分析慢查询和优化建议
4. 查看连接池使用情况
5. 评估系统健康度
6. 执行批量操作
7. 导入导出数据
8. 解决同步冲突
9. 使用 SQL 执行器
10. 使用系统维护工具

---

## 📊 数据完整性

### 外键约束
```sql
-- 商品关联卖家
FOREIGN KEY (seller_id) REFERENCES users(id) ON DELETE CASCADE

-- 评论关联商品和用户
FOREIGN KEY (item_id) REFERENCES items(id) ON DELETE CASCADE
FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
```

### 同步版本控制
```sql
-- 每条记录包含同步版本号
sync_version INT DEFAULT 0

-- 冲突检测
IF local_version != remote_version THEN
    INSERT INTO conflict_records...
END IF
```

---

## 🎓 学习价值

### 适合学习的技术点
1. ✅ **多数据库架构设计**
2. ✅ **数据同步与一致性**
3. ✅ **触发器与存储过程**
4. ✅ **性能监控与优化**
5. ✅ **大规模数据处理**
6. ✅ **Vue 3 + TypeScript**
7. ✅ **复杂UI组件开发**
8. ✅ **状态管理与路由**
9. ✅ **数据可视化**
10. ✅ **系统健康度评估**

---

## 📝 开发日志

```
2025-11-19:
- ✅ 生成 200 用户、500 商品、1000 评论、2000 消息、500 交易
- ✅ 创建管理员性能监控中心
- ✅ 创建管理员高级操作中心
- ✅ 实现四数据库同步状态监控
- ✅ 实现慢查询分析功能
- ✅ 实现连接池监控
- ✅ 实现系统健康度评分
- ✅ 实现批量数据操作
- ✅ 实现数据导入导出
- ✅ 实现同步冲突解决
- ✅ 实现 SQL 执行器
- ✅ 实现系统维护工具集
- ✅ 推送到 GitHub
```

---

## 🏆 项目亮点

### 功能亮点
1. **真实感强** - 200用户、500商品，数据丰富
2. **性能监控专业** - 多维度实时监控
3. **操作复杂** - 批量管理、冲突解决、SQL执行
4. **数据库特性丰富** - 触发器、存储过程、分区表
5. **UI专业美观** - Naive UI + 自定义设计

### 技术亮点
1. **四库同步机制** - 版本控制 + 冲突检测
2. **性能分析** - 慢查询分析 + 优化建议
3. **连接池监控** - 实时使用率可视化
4. **健康度评分** - 多指标综合评估
5. **大规模数据** - Python 自动生成测试数据

---

## 📞 联系方式

**项目仓库:** https://github.com/lll-hhh/Campus_Trading_System  
**开发者:** lll-hhh  
**最后更新:** 2025-11-19

---

**🎉 祝测试愉快！**
